<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldGPT - Minimal Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #0d1421; 
            color: #ffffff; 
            padding: 20px;
        }
        
        .header { 
            background: #1e2a47;
            padding: 20px; 
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .price-display {
            background: #2d3a5f;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid #00d4aa;
        }
        
        .price-value {
            font-size: 48px;
            color: #00d4aa;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .status {
            color: #888;
            font-size: 16px;
        }
        
        .chart-container {
            background: #1a2332;
            border-radius: 15px;
            padding: 20px;
            height: 600px;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü•á GoldGPT Trading Dashboard</h1>
        <p>Real-time Gold Price & Analysis</p>
    </div>
    
    <div class="price-display">
        <div class="price-value" id="goldPrice">Loading...</div>
        <div class="status" id="priceStatus">Fetching live price...</div>
        <div class="status" id="lastUpdate"></div>
    </div>
    
    <div class="chart-container">
        <div class="loading" id="chartLoading">
            üìà Loading TradingView Chart...
        </div>
        <div id="tradingview_chart" style="height: 100%; width: 100%; display: none;"></div>
    </div>

    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        console.log('üöÄ Starting GoldGPT Minimal Dashboard');
        
        // Global variables
        let widget = null;
        
        // Fetch gold price
        async function fetchGoldPrice() {
            try {
                console.log('üîÑ Fetching gold price...');
                const response = await fetch('/api/live-gold-price');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Price data received:', data);
                
                if (data.success && data.price) {
                    document.getElementById('goldPrice').textContent = `$${data.price.toFixed(2)}`;
                    document.getElementById('priceStatus').textContent = `‚úÖ Live Price ‚Ä¢ Last Update: ${new Date().toLocaleTimeString()}`;
                    document.getElementById('lastUpdate').textContent = `Source: ${data.source || 'Gold API'}`;
                    return true;
                } else {
                    throw new Error('Invalid price data');
                }
            } catch (error) {
                console.error('‚ùå Price fetch error:', error);
                document.getElementById('goldPrice').textContent = 'Error';
                document.getElementById('priceStatus').textContent = '‚ùå Failed to load price';
                return false;
            }
        }
        
        // Initialize TradingView chart
        function initChart() {
            try {
                console.log('üìà Initializing TradingView chart...');
                
                widget = new TradingView.widget({
                    "autosize": true,
                    "symbol": "OANDA:XAUUSD",
                    "interval": "15",
                    "timezone": "Etc/UTC",
                    "theme": "dark",
                    "style": "1",
                    "locale": "en",
                    "toolbar_bg": "#0d1421",
                    "enable_publishing": false,
                    "hide_top_toolbar": false,
                    "hide_legend": false,
                    "save_image": false,
                    "container_id": "tradingview_chart",
                    "studies": [
                        "RSI@tv-basicstudies",
                        "MACD@tv-basicstudies"
                    ]
                });
                
                // Show chart when loaded
                widget.onChartReady(function() {
                    console.log('‚úÖ TradingView chart loaded');
                    document.getElementById('chartLoading').style.display = 'none';
                    document.getElementById('tradingview_chart').style.display = 'block';
                });
                
            } catch (error) {
                console.error('‚ùå Chart initialization error:', error);
                document.getElementById('chartLoading').innerHTML = '‚ùå Chart failed to load';
            }
        }
        
        // Initialize dashboard
        async function initialize() {
            console.log('üîÑ Initializing dashboard...');
            
            // Fetch initial price
            await fetchGoldPrice();
            
            // Initialize chart
            initChart();
            
            // Set up auto-refresh
            setInterval(fetchGoldPrice, 5000); // Refresh every 5 seconds
            
            console.log('‚úÖ Dashboard initialized');
        }
        
        // Start when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }
    </script>
</body>
</html>
