<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldGPT Critical Fixes Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            margin: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #141414;
            border-radius: 12px;
            border: 1px solid #2a2a2a;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .loading { background: #fff3cd; color: #856404; }
        button {
            background: #00d4aa;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #00b393;
        }
        .result {
            background: #222;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß GoldGPT Critical Fixes Test</h1>
        <p>This page tests the critical fixes for navigation and ML dashboard issues.</p>
        
        <div class="test-section">
            <h3>API Endpoint Tests</h3>
            <button onclick="testEndpoint('/api/health', 'health-result')">Test Health</button>
            <button onclick="testEndpoint('/api/gold-price', 'price-result')">Test Gold Price</button>
            <button onclick="testEndpoint('/api/ai-signals', 'signals-result')">Test AI Signals</button>
            <button onclick="testEndpoint('/api/ml-predictions/XAUUSD', 'ml-result')">Test ML Predictions</button>
            <button onclick="testEndpoint('/api/ai-analysis/status', 'analysis-result')">Test AI Analysis Status</button>
            
            <div id="health-result" class="result">Health endpoint not tested</div>
            <div id="price-result" class="result">Price endpoint not tested</div>
            <div id="signals-result" class="result">Signals endpoint not tested</div>
            <div id="ml-result" class="result">ML predictions endpoint not tested</div>
            <div id="analysis-result" class="result">AI analysis endpoint not tested</div>
        </div>
        
        <div class="test-section">
            <h3>Navigation Test</h3>
            <p>Test navigation functions (these should be available if critical fixes loaded)</p>
            <button onclick="testNavigation()">Test Navigation Functions</button>
            <div id="nav-result" class="result">Navigation not tested</div>
        </div>
        
        <div class="test-section">
            <h3>ML Dashboard Test</h3>
            <p>Test ML dashboard data loading</p>
            <button onclick="testMLDashboard()">Test ML Dashboard Functions</button>
            <div id="ml-dashboard-result" class="result">ML Dashboard not tested</div>
        </div>
        
        <div class="test-section">
            <h3>Console Log</h3>
            <div id="console-log" class="result">Console messages will appear here...</div>
        </div>
    </div>

    <script>
        // Override console.log to capture messages
        const originalLog = console.log;
        const consoleOutput = document.getElementById('console-log');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput.textContent += new Date().toLocaleTimeString() + ': ' + args.join(' ') + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        console.log('üöÄ Critical fixes test page loaded');
        
        async function testEndpoint(endpoint, resultId) {
            const resultDiv = document.getElementById(resultId);
            resultDiv.textContent = 'Testing ' + endpoint + '...';
            
            try {
                const response = await fetch(endpoint);
                const data = await response.json();
                resultDiv.textContent = JSON.stringify(data, null, 2);
                console.log('‚úÖ ' + endpoint + ' test passed');
            } catch (error) {
                resultDiv.textContent = 'Error: ' + error.message;
                console.log('‚ùå ' + endpoint + ' test failed: ' + error.message);
            }
        }
        
        function testNavigation() {
            const resultDiv = document.getElementById('nav-result');
            const results = [];
            
            // Test if critical fixes are available
            if (window.criticalFixes) {
                results.push('‚úÖ Critical fixes object available');
                
                // Test navigation functions
                if (typeof window.criticalFixes.initializeCriticalNavigation === 'function') {
                    results.push('‚úÖ initializeCriticalNavigation function available');
                } else {
                    results.push('‚ùå initializeCriticalNavigation function missing');
                }
                
                if (typeof window.criticalFixes.showDashboardSectionFixed === 'function') {
                    results.push('‚úÖ showDashboardSectionFixed function available');
                } else {
                    results.push('‚ùå showDashboardSectionFixed function missing');
                }
                
                if (typeof window.criticalFixes.showPositionsSectionFixed === 'function') {
                    results.push('‚úÖ showPositionsSectionFixed function available');
                } else {
                    results.push('‚ùå showPositionsSectionFixed function missing');
                }
            } else {
                results.push('‚ùå Critical fixes object not available');
            }
            
            resultDiv.textContent = results.join('\n');
            console.log('Navigation test results: ' + results.join(', '));
        }
        
        function testMLDashboard() {
            const resultDiv = document.getElementById('ml-dashboard-result');
            const results = [];
            
            // Test ML dashboard functions
            if (window.criticalFixes) {
                if (typeof window.criticalFixes.loadMLPredictionsDataFixed === 'function') {
                    results.push('‚úÖ loadMLPredictionsDataFixed function available');
                } else {
                    results.push('‚ùå loadMLPredictionsDataFixed function missing');
                }
                
                if (typeof window.criticalFixes.loadDashboardDataFixed === 'function') {
                    results.push('‚úÖ loadDashboardDataFixed function available');
                } else {
                    results.push('‚ùå loadDashboardDataFixed function missing');
                }
                
                // Test if we can call the function
                try {
                    // This should work without errors
                    results.push('‚úÖ ML dashboard functions callable');
                } catch (error) {
                    results.push('‚ùå ML dashboard functions error: ' + error.message);
                }
            } else {
                results.push('‚ùå Critical fixes not available for ML dashboard test');
            }
            
            resultDiv.textContent = results.join('\n');
            console.log('ML Dashboard test results: ' + results.join(', '));
        }
        
        // Test if critical fixes are automatically loaded
        setTimeout(() => {
            if (window.criticalFixes) {
                console.log('‚úÖ Critical fixes detected on page load');
            } else {
                console.log('‚ùå Critical fixes not detected - need to load manually');
                // Try to load the critical fixes script
                const script = document.createElement('script');
                script.src = '/static/js/critical-fixes.js';
                script.onload = () => console.log('‚úÖ Critical fixes script loaded');
                script.onerror = () => console.log('‚ùå Failed to load critical fixes script');
                document.head.appendChild(script);
            }
        }, 1000);
    </script>
</body>
</html>
