<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldGPT - Simple Working Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #0d1421; 
            color: #ffffff; 
            padding: 20px;
        }
        
        .header { 
            background: linear-gradient(135deg, #1e2a47 0%, #2d3a5f 100%);
            padding: 25px; 
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid #00d4aa;
            box-shadow: 0 4px 20px rgba(0, 212, 170, 0.3);
        }
        
        .header h1 {
            color: #00d4aa;
            font-size: 36px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            color: #94a3b8;
            font-size: 16px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .card {
            background: linear-gradient(145deg, #1a2332 0%, #242b3d 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #334155;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
        }
        
        .card-title {
            color: #94a3b8;
            font-size: 14px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card-value {
            font-size: 32px;
            color: #00d4aa;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .card-status {
            color: #22c55e;
            font-size: 12px;
        }
        
        .chart-container {
            background: linear-gradient(145deg, #1a2332 0%, #242b3d 100%);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #334155;
            margin-bottom: 20px;
            min-height: 400px;
        }
        
        .chart-title {
            color: #00d4aa;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-content {
            height: 350px;
            background: #0f172a;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            position: relative;
        }
        
        .loading {
            font-size: 16px;
        }
        
        .error { color: #ef4444; }
        .success { color: #22c55e; }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            .header h1 {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🥇 GoldGPT Dashboard</h1>
        <p>Real-time Gold Trading & Analysis Platform</p>
    </div>
    
    <div class="main-grid">
        <div class="card">
            <div class="card-title">Live Gold Price</div>
            <div class="card-value" id="goldPrice">Loading...</div>
            <div class="card-status" id="priceStatus">Connecting...</div>
        </div>
        
        <div class="card">
            <div class="card-title">Market Status</div>
            <div class="card-value" id="marketStatus">Open</div>
            <div class="card-status" id="marketTime">Live</div>
        </div>
    </div>
    
    <div class="chart-container">
        <div class="chart-title">📈 Gold Price Chart (XAU/USD)</div>
        <div class="chart-content">
            <div class="loading" id="chartMessage">🔄 Loading TradingView Chart...</div>
        </div>
    </div>

    <!-- TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        console.log('🚀 GoldGPT Simple Dashboard Starting...');
        
        // Fetch and display gold price
        async function updateGoldPrice() {
            try {
                const response = await fetch('/api/live-gold-price');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.price) {
                    document.getElementById('goldPrice').textContent = `$${data.price.toFixed(2)}`;
                    document.getElementById('priceStatus').textContent = `Updated: ${new Date().toLocaleTimeString()}`;
                    document.getElementById('priceStatus').className = 'card-status success';
                } else {
                    throw new Error('Invalid data');
                }
            } catch (error) {
                console.error('Price fetch error:', error);
                document.getElementById('goldPrice').textContent = 'Error';
                document.getElementById('priceStatus').textContent = 'Connection failed';
                document.getElementById('priceStatus').className = 'card-status error';
            }
        }
        
        // Initialize TradingView
        function initChart() {
            try {
                if (typeof TradingView === 'undefined') {
                    document.getElementById('chartMessage').textContent = '❌ TradingView library not loaded';
                    return;
                }
                
                new TradingView.widget({
                    "autosize": true,
                    "symbol": "OANDA:XAUUSD",
                    "interval": "15",
                    "timezone": "Etc/UTC",
                    "theme": "dark",
                    "style": "1",
                    "locale": "en",
                    "toolbar_bg": "#0f172a",
                    "enable_publishing": false,
                    "hide_top_toolbar": false,
                    "save_image": false,
                    "container_id": "chartMessage",
                    "studies": ["RSI@tv-basicstudies"]
                });
                
                // Clear loading message after 3 seconds
                setTimeout(() => {
                    const chartEl = document.getElementById('chartMessage');
                    if (chartEl && chartEl.textContent.includes('Loading')) {
                        chartEl.textContent = '✅ Chart Ready';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Chart error:', error);
                document.getElementById('chartMessage').textContent = '❌ Chart failed to load';
            }
        }
        
        // Update market status
        function updateMarketStatus() {
            const now = new Date();
            const day = now.getDay(); // 0 = Sunday, 6 = Saturday
            const hour = now.getHours();
            
            let status = 'Closed';
            let time = 'Market closed';
            
            // Gold markets are open 24/5 (Monday-Friday)
            if (day >= 1 && day <= 5) {
                status = 'Open';
                
                if (hour >= 0 && hour < 6) {
                    time = 'Asian Session';
                } else if (hour >= 6 && hour < 14) {
                    time = 'European Session';
                } else {
                    time = 'US Session';
                }
            } else if (day === 0) {
                time = 'Weekend - Closed';
            }
            
            document.getElementById('marketStatus').textContent = status;
            document.getElementById('marketTime').textContent = time;
        }
        
        // Initialize everything
        function init() {
            console.log('Initializing dashboard...');
            
            // Initial data load
            updateGoldPrice();
            updateMarketStatus();
            
            // Initialize chart after TradingView loads
            setTimeout(initChart, 2000);
            
            // Set up intervals
            setInterval(updateGoldPrice, 10000); // Every 10 seconds
            setInterval(updateMarketStatus, 60000); // Every minute
            
            console.log('✅ Dashboard initialized');
        }
        
        // Start when page loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
